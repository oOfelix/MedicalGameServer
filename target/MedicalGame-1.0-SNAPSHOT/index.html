<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      #header {
        background-color: black;
        color: white;
        text-align: center;
        /* padding: 5px; */
      }

      #section {
        width: 100%;
        float: left;
        /* padding: 10px; */
      }

      #footer {
        background-color: black;
        color: rgb(255, 255, 255);
        clear: both;
        text-align: center;
        position: absolute;
        box-sizing: content-box;
        width: 100%;
        bottom: 0px;
        /* padding: 5px; */
      }

      .chart-container {
        width: 400px;
        height: 500px;
      }
    </style>
    <link rel="stylesheet" type="text/css" href="./css/global.css" />
    <script src="./js/chart.min.js"></script>
    <script src="./js/jquery-3.6.0.min.js"></script>
  </head>

  <body>
    <div id="header">
      <h1>MedicalGame BackStage</h1>
    </div>

    <div id="section">
      <div class="info_left" style="width: 50%; height: 100%; float: left;">
        <div class="two">
          <div class="two1"><img src="./img/pic.png" /></div>
          <div class="text1">用户</div>
          <div class="two2">
            <div class="two2-one" id="mess">账号:{{account}}</div>
            <div>密码:******</div>
          </div>
        </div>        
		<div id="chart" class="chart-container"></div> 
      </div>
      
	 <div id="info_right" style="float: right; width: 50%;">
		 <table width="600" border="1px" cellspacing="0">
		     <thead>
		     <tr>
		         <th>账号</th>
		         <th>密码</th>
		         <th>积分</th>
		         <th>状态</th>
		     </tr>
		     </thead>
		     <tbody id="tbMain"></tbody>
		 </table>
	 </div>
    </div>

    <div id="footer">made by nwu</div>
  </body>
  <script src="./js/jquery-3.6.0.min.js"></script>
  <script src="./js/echarts.min.js"></script>
  <script src="https://unpkg.com/vue@next"></script>
  <script>
    const App = {
      data() {
        return {
          account: "",
        };
      },
    };
    let vm = Vue.createApp(App).mount("#mess");

    function getUser() {
      data = {
        operationCode: 15,
      };
      $.ajax({
        type: "post",
        url: "http://localhost:8080/MedicalGame/OperationServlet",
        data: JSON.stringify(data),
        contentType: "application/json;charset=utf-8",
        dataType: "json",
        success: function (res) {
          let tbody = document.getElementById('tbMain');
          for (let i = 0; i < res.length; i++){
              tbody.appendChild(getDataRow(res[i]));
          }
        },
        error: function () {
          alert("数据丢失");
        },
      });
    }
	function getDataRow(o){
	    let row = document.createElement('tr');
	
	    let name = document.createElement('td');
	    name.innerHTML = o.userName;
	    row.appendChild(name);
	
	    let password = document.createElement('td');
	    password.innerHTML = o.password;
	    row.appendChild(password);
	
	    let points = document.createElement('td');
	    points.innerHTML = o.points;
	    row.appendChild(points);
	
	    let status = document.createElement('td');
	    status.innerHTML = o.status;
	    row.appendChild(status);
	
	    return row;
	}

    var myChart = echarts.init(document.getElementById("chart"));
    myChart.showLoading();
    myChart.setOption({
      title: {
        text: "脑电数据",
      },
      tooltip: {},
      legend: {
        data: ["销量"],
      },
      xAxis: {
        data: ["专注度", "脑电波"],
      },
      yAxis: {
        min: 0,
        max: 100,
      },
      series: [
        {
          name: "aaa",
          type: "bar",
          data: [],
        },
      ],
    });
    window.onload = function () {
      myChart.hideLoading();
      getApi();
      getUser();
    };

    function getApi() {
      $.get("http://localhost:8080/MedicalGame/BackendServlet").done(function (
        res
      ) {
        // 填入数据
        myChart.setOption({
          series: [
            {
              // 根据名字对应到相应的系列
              name: "aaa",
              data: [res.data2, res.data],
            },
          ],
        });
      });

      setTimeout(function () {
        getApi();
      }, 1000);
    }
  </script>
</html>
